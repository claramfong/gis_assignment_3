---
title: 'Assignment 3: Market Report Chicago'
author: "Clara Fong"
date: "5/25/2021"
always_allow_html: true
output:
  html_document:
    theme: cosmo
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      include = TRUE,
                      message = FALSE,
                      warning = FALSE)
```

```{r load packages, include = FALSE}
library(readr)
library(here)
library(sf)
library(tmap)
library(leaflet)
library(data.table)
library(tidyverse)
```

# The Assignment Description

Generate a market report for one Chicago community area using at least three measures. Your market report should have some theme, like a suite of health or transportation measures. Examples of measures could include accessibility to playgrounds, parks, or grocery stores, or rates of poverty, cancer, or income statistics.

* At least 1 measure should have a more sophisticated spatial analytic technique used for implementation. This will likely be a measure of some resource access. This could be a point-in-polygon (PIP) operation, buffer analysis (count of buffers or union of buffers showing coverage), density surface, etc.

* Additional measures can be visualized as points, lines, choropleth mapping, etc. (Choropleth mapping by itself is not considered the advanced analytic technique required for at least one measure.)

* You can include as many maps as you need to for your final report: this may be 1 map with all measures shown, 3 maps each highlighting a different variable, etc.

* You must include a summary of your market analysis, including (1) overview of your market and why you chose your measures, (2) description of data including source citations, (3) description of methods used to represent each measure, (4) a cohesive presentation and (5) discussion of the results. You should definitely note how different indicators for your community area exist in relation to its neighboring community areas. The summary can be brief (2-3 paragraphs) but must include the above. 

It is recommended that you calculate measures for the entire dataset of Chicago community areas, and then zoom into to your area of interest. If there is no visualization/analysis/discussion of how resources or statistics vary between neighboring areas, you will not receive full credit.


# Theme: Affordable housing and outdoor spaces

I was interested in looking at the kinds of outdoor amenities/spaces in areas with high levels of afforable housing units. My initial thinking is that there might be a difference in terms of sheer numbers of outdoor spaces (e.g., parks, playgrounds, etc.) in communities with higher affordable housing units, but also taking into account the "accessibility" by distance of these spaces Specficially, I want to know whether park areas have a wide set of amenities overlap with community areas that have a high number of affordable housing units.

## Data Sources

I sourced my data from three data sets on the [Chicago Data Portal](https://data.cityofchicago.org/):

* [Affordable rental housing developments data](https://data.cityofchicago.org/Community-Economic-Development/Affordable-Rental-Housing-Developments/s6ha-ppgi)
  + It should be noted that this data was originally in csv format, and I converted to to point data for the analysis below
  + For the sake of this assignment, I use the point data when combining the housing and park data because I wanted to create a chrolopeth map of the available amenities and units of affordable housing. However, as described below, I also wanted to conduct my own point-in-polygon operation on the housing data to demonstrate that I can do it.

* [Park data](https://data.cityofchicago.org/Parks-Recreation/Parks-Chicago-Park-District-Park-Boundaries-curren/ej32-qgdr)
  + The park data available has the park geometry and several columns that count whether a certain amenity is present in the park. Originally, I hoped that I would be able to use the park data as points, but this did not seem plausible given the data structure. 
  + I use the park data to build a chrolopleth map based on the available count information they have on whether a park has a playground
  
* [Dog-Friendly Parks data](https://data.cityofchicago.org/Parks-Recreation/Parks-Dog-Friendly-Map-deprecated-November-2016-/p97q-qace)
  + The last dataset I use is actually a subset from the park data, but it is point data of specific parks that are "dog-friendly"
  + I have included the point data below as separate points from the parks and affordable housing data
  + This data has ben depreciated as of 2016 (which it has since been combined with the previously mentioned park data). However, I wanted to practice plotting buffers and points, and the newer data does not have information on the coordinates for dog parks.

## Market Overview



## Summary of Maps

Given the variability in the data types and the scope of what we've learned in class, I have made three maps with some variation merging these three data sources together. It follows:

  1. **Afforable housing points**: transforming the csv data to point data to map the units of affordable housing, then using a point-in-polygon operation to count the number of affordable housing units in a given community boundary
  
  2. **Park areas and amenities**: plotting a chloropleth map of levels of amentities (specifically, I used variables that indicated a park had a playground, which is already counted by community area in the data)
  
  3. **Dog parks points**: there aren't a lot of dog parks, but I wanted to identify where they were relative to the areas with large numbers of playgrounds, and using a buffer analysis observe how much reach they have to neighborhoods that may have a higher number of affordable housing rentals
  
```{r loading data, include = FALSE}
parks <- st_read("parks")

housing <- read_csv(here("Affordable_Rental_Housing_Developments_clean.csv"))

dog_parks <- read_csv("dog_parks.csv")

boundaries <- st_read("comm_boundaries")
```

```{r plotting housing csv to points}

housing_pts <- st_as_sf(housing, coords = c("Longitude","Latitude"), crs = 4326)
#plot(housing_pts)

#save cleaned data as shp file
#st_write(housing_pts,"afford_housing.shp")

#creating a master df
#housing.parks.df <- housing_pts
```

# Part I: Understanding Affordable Housing

## Mapping Units of Affordable Housing as Points 

The first step for the PIP operation was to convert the csv affordable housing data into spatial data. After cleaning for that, I created an initial plot to look at the pattern of affordable housing units in Chicago

```{r initial housing plot}
#overlay point and polygons
  ## 1st layer (gets plotted first)
tm_shape(boundaries) + tm_borders(alpha = 0.4) + 
  ## 2nd layer (overlay)
  tm_shape(housing_pts) + tm_dots(size = 0.07, col="#756bb1") +
  tm_layout(main.title = "Affordable Housing Units in Chicago", 
            main.title.position = "center",
            main.title.size = 1.2) +
  tm_scale_bar(position = c("left", "bottom")) +
  tm_compass(position = c("left", "bottom")) +
  tm_credits("Source: Chicago Data Portal
             Author: Clara Fong, 2021", 
             size = 0.6,
             position=c("left", "bottom"))

#checking crs
#st_crs(boundaries) 
#st_crs(housing_pts)

#not "exactly" the same, so change it slightly
CRS.new <- st_crs(boundaries)
housing_pts <- st_transform(housing_pts, CRS.new)
```


This map reflects two, maybe three, clusters of affordable housing units in the West and South of Chicago. This is something worth noting when exploring the kinds of areas that might have more park spaces and outdoor amentities (playgrounds and dog parks). Do areas with more affordable housing have different levels of "access" to parks? In this sense, I have chosen to define access by a level of promixity to parks of different amenity qualities.


## Mapping Affordable Housing after PIP Operation

After counting the number of affordable housing units by each community area, the simplest way to summarize this spatial pattern, I plotted a chrolopleth map below. 

```{r point in polygon for housing data, echo = TRUE}

#spatial join
housing_in_boundaries <- st_join(housing_pts, boundaries, join = st_within)

#count crimes per tract
housing_pip <- housing_in_boundaries %>% 
  group_by(community) %>% 
  count() %>% 
  rename(afford_house_ct = n)

#removing geometry from previous df
housing_pip <- as.data.frame(housing_pip) %>% 
    select(community, afford_house_ct)

#merge to main df
housing.parks.df <- merge(boundaries, housing_pip, by="community")
```

```{r plotting pip as chrolopleth map}
tmap_mode("view")

tm_shape(housing.parks.df) + 
  tm_fill("afford_house_ct", n=6, pal = "YlOrRd", title="Number of Affordable Housing Units")
```

The map has 6 unique bins, and it was evident from this plot that there are three community areas on the West and South side (Humbolt Park, North Lawndale, and Grand Boulevard) that have the highest number of afforable housing units compared to the rest of Chicago. Moving forward I will focus on **one of these three areas** and plot the difference in park numbers compared to neighboring peers.

# Part II: Park Amenitities by Playground Availability

Similar to the chrolopleth map above, I want to look at the number of playgrounds in Chicago parks. However, since the point-in-polygon operation is already done for this dataset (that is, they already count the number of playgrounds without providing coordinate locations of each playground), I will be creating the chrolopleth map based on existing data provided.

```{r playgrounds in polygon}

# clean the playground variables
playgrounds <- parks %>% 
  select(geometry,
         park,
         playground,
         playgrou_1) %>% 
  mutate(playground_sum = playground + playgrou_1)


tm_shape(housing.parks.df) + 
  tm_fill("afford_house_ct", alpha = 0.7, n=6, pal = "YlOrRd", title="Affordable Housing") +
tm_shape(playgrounds) + 
  tm_polygons(col='playground', n=5, title = "Playgrounds", palette = "Greens")
  
```

The map above overlays a simply chrolopeth map of the park areas in Chicago that have a playground (by number of playgrounds) with the previously created affordable housing chrolopleth of the PIP operation in part 1. We can see in this plot that Humbolt Park has a park with 5 playgrounds between its borders and West town. However, the rest of the smaller parks within Humbolt Park all have 0-2 playgrounds.


# Part III: Incorporating Dog Park Points (w/ Buffers)



```{r cleaning dog data}

# cleaning coordinate data
dog_parks <- dog_parks %>% 
  separate("LOCATION", c("address", "LOCATION"), sep = "[(]") %>% 
  separate("LOCATION", c("long", "lat"), sep = ",") %>% 
  separate("lat", c("lat", "etc"), sep = "[)]") %>% 
  mutate(long = as.numeric(long),
         lat = as.numeric(lat)) %>% 
  select(`PARK NUMBER`, `PARK NAME`, long, lat) %>% 
  rename(park = `PARK NAME`)


# turning dog park data to spatial data
dog_pts <- st_as_sf(dog_parks, coords = c("lat","long"), crs = 4326)
```


```{r dog data spatial info}

#save as a shp file
#st_write(dog_pts, "dog_park_points.shp")

#checking CRS
#st_crs(playgrounds)
#st_crs(dog_pts)

#creating a buffer for dog-parks
dog_buff <- st_buffer(dog_pts, dist = 0.002) #~ 2 km distance buffer


# plot onto existing maps
tm_shape(housing.parks.df) + 
  tm_fill(col = "afford_house_ct", alpha = 0.7, n=6, pal = "YlOrRd", title="Affordable Housing") +
tm_shape(playgrounds) + 
  tm_polygons(col='playground', n=5, title = "Playgrounds", palette = "Greens") +
tm_shape(dog_pts) +
  tm_symbols(col = "#2b8cbe", size = 0.05, alpha = 0.7) +
tm_shape(dog_buff) + 
  tm_borders(col = "#a6bddb", alpha = 0.5, lwd = 2) 

```

I added 2 km buffers to the dog parks data to show a walkable reach to each designated dog park. Unsurprisingly, dog parks were in areas with few affordable housing units, perhaps due to the fact that the amenity caters towards a certain demographic of dog owners (aka. those who can afford to housing another living animal in their home/are permitted to have pets in their rental units).

Humbolt Park does not have any explicit dog parks, according to this data.


# Results and Dicussion





